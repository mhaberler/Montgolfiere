<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Montgolfiere Data Flow - BLE Sensors to Tab1 Display</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            overflow-x: hidden;
        }

        .slides {
            width: 100vw;
            height: 100vh;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            scroll-behavior: smooth;
        }

        .slide {
            width: 100%;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px;
            scroll-snap-align: start;
            position: relative;
        }

        .slide-content {
            background: white;
            border-radius: 20px;
            padding: 50px;
            max-width: 1200px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            font-size: 3rem;
            color: #667eea;
            margin-bottom: 20px;
            text-align: center;
        }

        h2 {
            font-size: 2rem;
            color: #764ba2;
            margin-bottom: 30px;
            text-align: center;
        }

        h3 {
            font-size: 1.5rem;
            color: #667eea;
            margin: 25px 0 15px 0;
        }

        p, li {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #555;
            margin-bottom: 10px;
        }

        .flow-diagram {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 30px 0;
        }

        .flow-layer {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 25px;
            border-radius: 15px;
            border-left: 5px solid #667eea;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .flow-layer:hover {
            transform: translateX(10px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .flow-layer h4 {
            color: #764ba2;
            font-size: 1.3rem;
            margin-bottom: 10px;
        }

        .flow-layer code {
            background: #2d3748;
            color: #68d391;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.95rem;
        }

        .component-box {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
        }

        .component-box h4 {
            color: #667eea;
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .arrow {
            text-align: center;
            font-size: 2rem;
            color: #667eea;
            margin: 10px 0;
        }

        .code-snippet {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            margin: 15px 0;
        }

        .code-snippet .keyword {
            color: #fc8181;
        }

        .code-snippet .function {
            color: #68d391;
        }

        .code-snippet .string {
            color: #f6e05e;
        }

        .code-snippet .comment {
            color: #a0aec0;
            font-style: italic;
        }

        .nav-buttons {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .nav-btn {
            background: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .nav-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
        }

        .slide-number {
            position: fixed;
            bottom: 30px;
            left: 30px;
            background: white;
            padding: 10px 20px;
            border-radius: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            font-weight: bold;
            color: #667eea;
        }

        ul {
            margin-left: 25px;
        }

        .highlight {
            background: #fef5e7;
            padding: 15px;
            border-left: 4px solid #f39c12;
            border-radius: 8px;
            margin: 20px 0;
        }

        .sensor-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .sensor-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            transition: transform 0.3s;
        }

        .sensor-card:hover {
            transform: translateY(-5px);
        }

        .sensor-card h5 {
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .slide-content {
                padding: 30px 20px;
            }

            h1 {
                font-size: 2rem;
            }

            h2 {
                font-size: 1.5rem;
            }

            p, li {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="slides" id="slides">
        <!-- Slide 1: Title -->
        <div class="slide" id="slide1">
            <div class="slide-content">
                <h1>üéà Montgolfiere Data Flow</h1>
                <h2>From Bluetooth Sensors to Tab1 Display</h2>
                <p style="text-align: center; font-size: 1.2rem; margin-top: 30px; color: #764ba2;">
                    A comprehensive overview of how sensor data flows through the Montgolfiere balloon flight monitoring application
                </p>
                <div style="text-align: center; margin-top: 50px;">
                    <p><strong>Technologies:</strong> Ionic + Vue 3 + Capacitor + BLE</p>
                    <p><strong>Platform:</strong> iOS & Android</p>
                </div>
            </div>
        </div>

        <!-- Slide 2: Architecture Overview -->
        <div class="slide" id="slide2">
            <div class="slide-content">
                <h2>üìä Architecture Overview</h2>
                <div class="flow-diagram">
                    <div class="flow-layer">
                        <h4>1Ô∏è‚É£ Hardware Layer</h4>
                        <p>Bluetooth Low Energy (BLE) sensors broadcasting advertisement packets</p>
                    </div>
                    <div class="arrow">‚Üì</div>
                    <div class="flow-layer">
                        <h4>2Ô∏è‚É£ Bluetooth Layer</h4>
                        <p>Capacitor BLE Client scanning and capturing advertisements</p>
                    </div>
                    <div class="arrow">‚Üì</div>
                    <div class="flow-layer">
                        <h4>3Ô∏è‚É£ Decoding Layer</h4>
                        <p>Protocol-specific decoders parsing raw data into structured values</p>
                    </div>
                    <div class="arrow">‚Üì</div>
                    <div class="flow-layer">
                        <h4>4Ô∏è‚É£ State Management Layer</h4>
                        <p>Device mapping composable organizing data by units</p>
                    </div>
                    <div class="arrow">‚Üì</div>
                    <div class="flow-layer">
                        <h4>5Ô∏è‚É£ UI Layer</h4>
                        <p>Tab1Page displaying real-time sensor data in tabular format</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 3: Hardware Layer -->
        <div class="slide" id="slide3">
            <div class="slide-content">
                <h2>üì° 1. Hardware Layer - BLE Sensors</h2>
                <p>Various sensor types broadcast BLE advertisement packets containing telemetry data:</p>
                
                <div class="sensor-types">
                    <div class="sensor-card">
                        <h5>üå°Ô∏è Ruuvi</h5>
                        <p>Temperature, humidity, pressure sensors</p>
                        <small>ID: 0x0499</small>
                    </div>
                    <div class="sensor-card">
                        <h5>üî• Mopeka</h5>
                        <p>Propane tank level sensors</p>
                        <small>ID: 0x0059</small>
                    </div>
                    <div class="sensor-card">
                        <h5>üöó TPMS</h5>
                        <p>Tire pressure monitoring</p>
                        <small>ID: 0x00AC, 0x0100</small>
                    </div>
                    <div class="sensor-card">
                        <h5>üìä Otodata</h5>
                        <p>Generic telemetry sensors</p>
                        <small>ID: 0x03B1</small>
                    </div>
                    <div class="sensor-card">
                        <h5>üè† BTHome v2</h5>
                        <p>Smart home sensors</p>
                        <small>UUID: 0000FCD2</small>
                    </div>
                    <div class="sensor-card">
                        <h5>‚ö° Rotarex</h5>
                        <p>Custom sensors</p>
                        <small>ID: 0xFFFF</small>
                    </div>
                </div>

                <div class="highlight">
                    <strong>üìù Note:</strong> Each sensor broadcasts at different intervals (1-360 seconds) based on battery optimization and use case requirements.
                </div>
            </div>
        </div>

        <!-- Slide 4: Bluetooth Layer -->
        <div class="slide" id="slide4">
            <div class="slide-content">
                <h2>üì≤ 2. Bluetooth Layer - BLE Scanning</h2>
                
                <div class="component-box">
                    <h4>üìÅ File: <code>src/sensors/blesensors.ts</code></h4>
                    <p>Central BLE management module responsible for:</p>
                    <ul>
                        <li>Initializing the BLE client using <code>@capacitor-community/bluetooth-le</code></li>
                        <li>Starting continuous low-latency scanning with <code>allowDuplicates: true</code></li>
                        <li>Filtering advertisements by allowed manufacturer IDs and service UUIDs</li>
                        <li>Maintaining a reactive Map of discovered devices</li>
                        <li>Implementing watchdog timer for scan health monitoring</li>
                    </ul>
                </div>

                <h3>Key Functions:</h3>
                <div class="code-snippet">
<span class="comment">// Initialize BLE client</span>
<span class="keyword">export const</span> <span class="function">initializeBLE</span> = <span class="keyword">async</span> () => {
  <span class="keyword">await</span> BleClient.<span class="function">initialize</span>({ androidNeverForLocation: <span class="keyword">true</span> });
}

<span class="comment">// Start scanning with low latency mode</span>
<span class="keyword">export const</span> <span class="function">startBLEScan</span> = <span class="keyword">async</span> () => {
  <span class="keyword">await</span> BleClient.<span class="function">requestLEScan</span>(
    { 
      allowDuplicates: <span class="keyword">true</span>, 
      scanMode: ScanMode.SCAN_MODE_LOW_LATENCY 
    },
    (result) => {
      <span class="comment">// Process each advertisement...</span>
    }
  );
}
                </div>

                <div class="highlight">
                    <strong>üîç Smart Filtering:</strong> Only beacons matching known manufacturer IDs or service UUIDs are processed, reducing CPU load and improving battery life.
                </div>
            </div>
        </div>

        <!-- Slide 5: Advertisement Processing -->
        <div class="slide" id="slide5">
            <div class="slide-content">
                <h2>‚öôÔ∏è 3. Advertisement Processing</h2>
                
                <h3>When an Advertisement Arrives:</h3>
                <div class="flow-diagram">
                    <div class="flow-layer">
                        <h4>Step 1: Filter Check</h4>
                        <p>Verify manufacturer ID or service UUID is in allowed list</p>
                        <div class="code-snippet">
<span class="keyword">const</span> <span class="function">isAllowedBeacon</span> = (result) => {
  <span class="keyword">return</span> result.manufacturerData || result.serviceData;
}
                        </div>
                    </div>

                    <div class="flow-layer">
                        <h4>Step 2: Decode Sensor Data</h4>
                        <p>Call protocol-specific decoder based on manufacturer/service ID</p>
                        <div class="code-snippet">
<span class="keyword">const</span> decoded = <span class="function">decodeSensor</span>(result);
<span class="comment">// Returns: { type, sortingPriority, value }</span>
                        </div>
                    </div>

                    <div class="flow-layer">
                        <h4>Step 3: Update Device Map</h4>
                        <p>Store or update device in reactive Map with timestamp</p>
                        <div class="code-snippet">
devices.value.<span class="function">set</span>(deviceId, {
  scanResult: result,
  decoded: decoded,
  lastSeen: Date.<span class="function">now</span>()
});
                        </div>
                    </div>

                    <div class="flow-layer">
                        <h4>Step 4: Update Unit Data</h4>
                        <p>If device is assigned to a unit, update unit's sensor data</p>
                        <div class="code-snippet">
<span class="function">updateUnitData</span>(deviceId, decoded.value, decoded.type);
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 6: Decoding Layer -->
        <div class="slide" id="slide6">
            <div class="slide-content">
                <h2>üîì 4. Decoding Layer - Protocol Parsers</h2>
                
                <div class="component-box">
                    <h4>üìÅ Directory: <code>src/decoders/</code></h4>
                    <p>Each sensor protocol has a dedicated decoder:</p>
                </div>

                <div class="sensor-types">
                    <div class="sensor-card">
                        <h5>ruuvi.ts</h5>
                        <p>Parses RuuviTag format 3 & 5</p>
                    </div>
                    <div class="sensor-card">
                        <h5>mopeka.ts</h5>
                        <p>Decodes tank level data</p>
                    </div>
                    <div class="sensor-card">
                        <h5>bthome.ts</h5>
                        <p>BTHome v2 service data</p>
                    </div>
                    <div class="sensor-card">
                        <h5>tpms.ts</h5>
                        <p>Tire pressure formats</p>
                    </div>
                    <div class="sensor-card">
                        <h5>otodata.ts</h5>
                        <p>Custom telemetry</p>
                    </div>
                </div>

                <h3>Example: Mopeka Decoder</h3>
                <div class="code-snippet">
<span class="keyword">export const</span> <span class="function">parseMopeka</span> = (data: DataView) => {
  <span class="keyword">const</span> mopeka = {};
  
  <span class="comment">// Extract reading in ticks</span>
  <span class="keyword">const</span> reading = data.<span class="function">getUint16</span>(<span class="string">8</span>, <span class="keyword">true</span>);
  
  <span class="comment">// Convert to level percentage</span>
  mopeka.percent = (reading / <span class="string">255</span> * <span class="string">100</span>).<span class="function">toFixed</span>(<span class="string">1</span>);
  
  <span class="comment">// Extract temperature</span>
  mopeka.temp = data.<span class="function">getUint8</span>(<span class="string">10</span>) - <span class="string">40</span>;
  
  <span class="comment">// Battery level</span>
  mopeka.batpct = data.<span class="function">getUint8</span>(<span class="string">11</span>);
  
  <span class="keyword">return</span> mopeka;
}
                </div>

                <div class="highlight">
                    <strong>üéØ Output:</strong> Decoders return plain objects with standardized metric names (temp, hum, percent, level, batpct, etc.)
                </div>
            </div>
        </div>

        <!-- Slide 7: Device Mapping -->
        <div class="slide" id="slide7">
            <div class="slide-content">
                <h2>üó∫Ô∏è 5. Device Mapping Layer</h2>
                
                <div class="component-box">
                    <h4>üìÅ File: <code>src/composables/useDeviceMapping.ts</code></h4>
                    <p>Central state management for mapping devices to balloon units:</p>
                </div>

                <h3>Core Responsibilities:</h3>
                <ul>
                    <li><strong>Device-to-Unit Assignment:</strong> User assigns BLE devices to logical units (Envelope, Tank1, Tank2, etc.)</li>
                    <li><strong>Persistent Storage:</strong> Mappings stored via <code>usePersistedRef</code> for app restarts</li>
                    <li><strong>Real-time Data Aggregation:</strong> Consolidates multiple sensors per unit</li>
                    <li><strong>Status Calculation:</strong> Determines online/warning/offline based on sensor age and type-specific thresholds</li>
                    <li><strong>Metric Filtering:</strong> Categorizes metrics as primary, secondary, or hidden per unit type</li>
                </ul>

                <h3>Data Structures:</h3>
                <div class="code-snippet">
<span class="comment">// Device ‚Üí Unit mapping (persistent)</span>
<span class="keyword">const</span> deviceMappings = <span class="function">usePersistedRef</span>({
  <span class="string">"AA:BB:CC:DD:EE:FF"</span>: <span class="string">"Tank1"</span>,
  <span class="string">"11:22:33:44:55:66"</span>: <span class="string">"Envelope"</span>
});

<span class="comment">// Unit ‚Üí Sensors data (reactive, volatile)</span>
<span class="keyword">const</span> unitSensors = <span class="function">ref</span>({
  <span class="string">Envelope</span>: [{ deviceId, decodedValue, lastUpdate, deviceType }],
  <span class="string">Tank1</span>: [{ deviceId, decodedValue, lastUpdate, deviceType }],
  ...
});
                </div>
            </div>
        </div>

        <!-- Slide 8: Status Calculation -->
        <div class="slide" id="slide8">
            <div class="slide-content">
                <h2>üö¶ 6. Status Calculation & Thresholds</h2>
                
                <h3>Per-Sensor-Type Timeouts:</h3>
                <p>Different sensor types have different broadcast intervals, so status thresholds are customized:</p>

                <div class="code-snippet">
<span class="keyword">const</span> SENSOR_STATUS_THRESHOLDS = {
  Ruuvi: {
    online: <span class="string">5000</span>,    <span class="comment">// 5s (broadcasts every 1-2s)</span>
    warning: <span class="string">10000</span>,  <span class="comment">// 10s</span>
    offline: <span class="string">15000</span>   <span class="comment">// 15s</span>
  },
  Mopeka: {
    online: <span class="string">20000</span>,   <span class="comment">// 20s (broadcasts every 5-10s)</span>
    warning: <span class="string">30000</span>,
    offline: <span class="string">60000</span>
  },
  TPMS: {
    online: <span class="string">400000</span>,  <span class="comment">// 6.6min (broadcasts every 360s)</span>
    warning: <span class="string">500000</span>,
    offline: <span class="string">800000</span>
  }
};
                </div>

                <h3>Status Calculation Logic:</h3>
                <div class="flow-diagram">
                    <div class="flow-layer">
                        <h4>1. Filter Active Sensors</h4>
                        <p>Only count sensors within their type-specific offline threshold</p>
                    </div>
                    <div class="flow-layer">
                        <h4>2. Evaluate Each Sensor</h4>
                        <p>Age in ms compared against online/warning/offline thresholds</p>
                    </div>
                    <div class="flow-layer">
                        <h4>3. Aggregate Status</h4>
                        <p>If ANY sensor offline ‚Üí danger, if ANY warning ‚Üí warning, else success</p>
                    </div>
                </div>

                <div class="highlight">
                    <strong>‚ôªÔ∏è Reactive Updates:</strong> Status recalculates every 2 seconds via reactive timestamp, keeping UI fresh without manual polling.
                </div>
            </div>
        </div>

        <!-- Slide 9: UI Layer -->
        <div class="slide" id="slide9">
            <div class="slide-content">
                <h2>üñ•Ô∏è 7. UI Layer - Tab1Page Display</h2>
                
                <div class="component-box">
                    <h4>üìÅ File: <code>src/views/Tab1Page.vue</code></h4>
                    <p>Main flight status display showing GPS, altitude, velocity, and sensor units</p>
                </div>

                <div class="component-box">
                    <h4>üìÅ Component: <code>src/components/units/UnitsTable.vue</code></h4>
                    <p>Tabular display of all sensor units with their metrics</p>
                </div>

                <h3>UnitsTable Component Flow:</h3>
                <div class="code-snippet">
<span class="comment">// 1. Get unit configurations</span>
<span class="keyword">const</span> unitConfigs = [
  { type: <span class="string">'Envelope'</span>, label: <span class="string">'Envelope'</span>, icon: balloonOutline },
  { type: <span class="string">'OAT'</span>, label: <span class="string">'OAT'</span>, icon: thermometerOutline },
  { type: <span class="string">'Tank1'</span>, label: <span class="string">'Tank1'</span>, icon: flameOutline },
  ...
];

<span class="comment">// 2. For each unit, compute display data</span>
<span class="keyword">const</span> unitsData = <span class="function">computed</span>(() => {
  <span class="keyword">return</span> unitConfigs.<span class="function">map</span>(config => ({
    type: config.type,
    label: config.label,
    icon: config.icon,
    status: <span class="function">getUnitStatus</span>(config.type),  <span class="comment">// online/warning/offline</span>
    metrics: <span class="function">getUnitMetrics</span>(config.type)   <span class="comment">// temp, hum, etc.</span>
  })).<span class="function">filter</span>(unit => unit.hasSensors);  <span class="comment">// Hide empty units</span>
});
                </div>
            </div>
        </div>

        <!-- Slide 10: Display Format -->
        <div class="slide" id="slide10">
            <div class="slide-content">
                <h2>üìã 8. Tabular Display Format</h2>
                
                <h3>Table Structure:</h3>
                <div style="overflow-x: auto; margin: 20px 0;">
                    <table style="width: 100%; border-collapse: collapse; border: 1px solid #e2e8f0;">
                        <thead>
                            <tr style="background: #f7fafc;">
                                <th style="padding: 12px; border: 1px solid #e2e8f0; text-align: left;">Unit</th>
                                <th style="padding: 12px; border: 1px solid #e2e8f0; text-align: left;">Metrics</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="background: rgba(16, 185, 129, 0.05);">
                                <td style="padding: 12px; border: 1px solid #e2e8f0;">
                                    <strong>üéà Envelope</strong>
                                </td>
                                <td style="padding: 12px; border: 1px solid #e2e8f0;">
                                    Temp: 24.5¬∞ | Bat: 95%
                                </td>
                            </tr>
                            <tr style="background: rgba(16, 185, 129, 0.05);">
                                <td style="padding: 12px; border: 1px solid #e2e8f0;">
                                    <strong>üå°Ô∏è OAT</strong>
                                </td>
                                <td style="padding: 12px; border: 1px solid #e2e8f0;">
                                    Temp: 18.2¬∞ | Hum: 65% | Bat: 87%
                                </td>
                            </tr>
                            <tr style="background: rgba(245, 158, 11, 0.1);">
                                <td style="padding: 12px; border: 1px solid #e2e8f0;">
                                    <strong>üî• Tank1</strong>
                                </td>
                                <td style="padding: 12px; border: 1px solid #e2e8f0;">
                                    %: 78% | Level: 245mm | Bar: 12.5
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h3>Metric Formatting:</h3>
                <ul>
                    <li><strong>Temperature:</strong> <code>24.5¬∞</code> (1 decimal)</li>
                    <li><strong>Humidity:</strong> <code>65%</code> (no decimals)</li>
                    <li><strong>Battery:</strong> <code>87%</code> (no decimals)</li>
                    <li><strong>Level:</strong> <code>245mm</code> (no decimals)</li>
                    <li><strong>Pressure:</strong> <code>12.5</code> (1 decimal)</li>
                </ul>

                <div class="highlight">
                    <strong>üé® Visual Indicators:</strong>
                    <ul>
                        <li>Row background colored by status (green/yellow/red)</li>
                        <li>Metric values colored by data age (fresh/recent/stale/old)</li>
                        <li>Units without sensors are automatically hidden</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Slide 11: Complete Flow Summary -->
        <div class="slide" id="slide11">
            <div class="slide-content">
                <h2>üîÑ Complete Data Flow Summary</h2>
                
                <div class="flow-diagram">
                    <div class="flow-layer" style="background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);">
                        <h4>üì° BLE Advertisement Broadcast</h4>
                        <p>Sensor ‚Üí BLE radio ‚Üí Advertisement packet every 1-360s</p>
                    </div>

                    <div class="flow-layer" style="background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%); color: white;">
                        <h4>üì≤ Scan & Capture</h4>
                        <p><code>blesensors.ts</code> ‚Üí <code>BleClient.requestLEScan()</code> ‚Üí Filter by manufacturer ID</p>
                    </div>

                    <div class="flow-layer" style="background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%); color: white;">
                        <h4>üîì Decode</h4>
                        <p><code>decoders/*.ts</code> ‚Üí Protocol-specific parser ‚Üí Structured JSON object</p>
                    </div>

                    <div class="flow-layer" style="background: linear-gradient(135deg, #fd79a8 0%, #e84393 100%); color: white;">
                        <h4>üíæ Store & Map</h4>
                        <p><code>useDeviceMapping</code> ‚Üí Update <code>devices Map</code> ‚Üí Route to assigned unit</p>
                    </div>

                    <div class="flow-layer" style="background: linear-gradient(135deg, #55efc4 0%, #00b894 100%); color: white;">
                        <h4>üßÆ Calculate Status</h4>
                        <p>Check sensor age vs thresholds ‚Üí Aggregate status ‚Üí Update reactive state</p>
                    </div>

                    <div class="flow-layer" style="background: linear-gradient(135deg, #fab1a0 0%, #e17055 100%); color: white;">
                        <h4>üñ•Ô∏è Render UI</h4>
                        <p><code>UnitsTable.vue</code> ‚Üí Format metrics ‚Üí Display in table ‚Üí Color by status</p>
                    </div>
                </div>

                <div class="highlight">
                    <strong>‚ö° Performance:</strong> Entire flow from advertisement to UI update happens in <strong>&lt;50ms</strong>, enabling real-time display updates.
                </div>
            </div>
        </div>

        <!-- Slide 12: Key Technologies -->
        <div class="slide" id="slide12">
            <div class="slide-content">
                <h2>üõ†Ô∏è Key Technologies & Patterns</h2>
                
                <div class="sensor-types">
                    <div class="sensor-card">
                        <h5>Vue 3 Composition API</h5>
                        <p>Reactive state management with computed properties and refs</p>
                    </div>
                    <div class="sensor-card">
                        <h5>Capacitor BLE Plugin</h5>
                        <p>Cross-platform BLE scanning on iOS & Android</p>
                    </div>
                    <div class="sensor-card">
                        <h5>Composables Pattern</h5>
                        <p>Reusable logic for device mapping and persistence</p>
                    </div>
                    <div class="sensor-card">
                        <h5>Persistent Storage</h5>
                        <p>Device assignments survive app restarts</p>
                    </div>
                    <div class="sensor-card">
                        <h5>Watchdog Timers</h5>
                        <p>Auto-restart scanning if no data received</p>
                    </div>
                    <div class="sensor-card">
                        <h5>Type Safety</h5>
                        <p>TypeScript interfaces for all data structures</p>
                    </div>
                </div>

                <h3>Design Patterns:</h3>
                <ul>
                    <li><strong>Observer Pattern:</strong> Reactive state triggers UI updates automatically</li>
                    <li><strong>Strategy Pattern:</strong> Different decoders for different protocols</li>
                    <li><strong>Repository Pattern:</strong> Centralized device and unit state management</li>
                    <li><strong>Composable Pattern:</strong> Reusable logic via Vue composables</li>
                </ul>
            </div>
        </div>

        <!-- Slide 13: Error Handling & Reliability -->
        <div class="slide" id="slide13">
            <div class="slide-content">
                <h2>üõ°Ô∏è Error Handling & Reliability</h2>
                
                <h3>Robustness Features:</h3>
                
                <div class="component-box">
                    <h4>1. Watchdog Timer</h4>
                    <p>If no BLE advertisements received for 10 seconds, automatically restart scanning</p>
                    <div class="code-snippet">
<span class="keyword">const</span> WATCHDOG_TIMEOUT = <span class="string">10000</span>; <span class="comment">// 10 seconds</span>

<span class="keyword">const</span> <span class="function">resetWatchdog</span> = () => {
  <span class="keyword">if</span> (scanWatchdogTimer) <span class="function">clearTimeout</span>(scanWatchdogTimer);
  
  scanWatchdogTimer = <span class="function">setTimeout</span>(<span class="keyword">async</span> () => {
    bleScanTimeouts.value++;
    <span class="keyword">await</span> <span class="function">restartBLEScan</span>();
  }, WATCHDOG_TIMEOUT);
};
                    </div>
                </div>

                <div class="component-box">
                    <h4>2. Sensor Cleanup</h4>
                    <p>Remove sensors that haven't been seen for 10+ minutes to prevent memory leaks</p>
                </div>

                <div class="component-box">
                    <h4>3. Age-Based Status</h4>
                    <p>Visual indicators show data freshness - green (fresh) to red (stale/offline)</p>
                </div>

                <div class="component-box">
                    <h4>4. App Lifecycle Management</h4>
                    <ul>
                        <li><strong>Foreground:</strong> Restart BLE scanning, location, barometer</li>
                        <li><strong>Background:</strong> Stop scanning to save battery</li>
                    </ul>
                </div>

                <div class="highlight">
                    <strong>üìä Telemetry:</strong> Counters track scan timeouts, init errors, advertisements, and device updates for debugging.
                </div>
            </div>
        </div>

        <!-- Slide 14: User Interaction Flow -->
        <div class="slide" id="slide14">
            <div class="slide-content">
                <h2>üë§ User Interaction Flow</h2>
                
                <h3>Setup Phase (Tab2 - BLE Scanner):</h3>
                <div class="flow-diagram">
                    <div class="flow-layer">
                        <h4>Step 1: Discover Devices</h4>
                        <p>User views list of nearby BLE sensors with type, ID, RSSI, and decoded data</p>
                    </div>
                    <div class="flow-layer">
                        <h4>Step 2: Assign to Units</h4>
                        <p>User selects unit (Envelope, Tank1, Tank2, etc.) from dropdown for each device</p>
                    </div>
                    <div class="flow-layer">
                        <h4>Step 3: Mappings Persist</h4>
                        <p>Assignments saved to local storage - no need to reassign on app restart</p>
                    </div>
                </div>

                <h3>Monitoring Phase (Tab1 - Flight Status):</h3>
                <div class="flow-diagram">
                    <div class="flow-layer">
                        <h4>Real-time Display</h4>
                        <p>User sees all units in table with current metrics and color-coded status</p>
                    </div>
                    <div class="flow-layer">
                        <h4>Auto-refresh</h4>
                        <p>UI updates automatically every time new advertisement arrives (no manual refresh)</p>
                    </div>
                    <div class="flow-layer">
                        <h4>Status Awareness</h4>
                        <p>Color coding instantly shows which units are online, warning, or offline</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 15: Conclusion -->
        <div class="slide" id="slide15">
            <div class="slide-content">
                <h1>üéØ Summary</h1>
                
                <div class="component-box" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
                    <h3 style="color: white; text-align: center; margin-bottom: 20px;">The Complete Journey</h3>
                    <p style="color: white; text-align: center; font-size: 1.2rem;">
                        BLE Sensor ‚Üí Advertisement ‚Üí Scan ‚Üí Decode ‚Üí Map ‚Üí Calculate ‚Üí Display
                    </p>
                </div>

                <h3>Key Takeaways:</h3>
                <ul>
                    <li>‚úÖ <strong>Real-time:</strong> Sensor data flows from hardware to UI in &lt;50ms</li>
                    <li>‚úÖ <strong>Robust:</strong> Watchdog timers, error handling, and auto-recovery</li>
                    <li>‚úÖ <strong>Efficient:</strong> Smart filtering and type-specific timeouts optimize battery</li>
                    <li>‚úÖ <strong>Flexible:</strong> User-configurable device-to-unit assignments</li>
                    <li>‚úÖ <strong>Persistent:</strong> Configuration survives app restarts</li>
                    <li>‚úÖ <strong>Cross-platform:</strong> Works on both iOS and Android</li>
                    <li>‚úÖ <strong>Maintainable:</strong> Clean separation of concerns with clear module boundaries</li>
                </ul>

                <div style="text-align: center; margin-top: 40px; padding: 30px; background: #f7fafc; border-radius: 15px;">
                    <h2 style="color: #667eea;">üéà Ready for Flight!</h2>
                    <p style="font-size: 1.2rem; color: #555;">
                        The Montgolfiere system provides reliable, real-time monitoring<br/>
                        of all balloon systems during flight operations.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="nav-buttons">
        <button class="nav-btn" onclick="navigate(-1)" title="Previous">‚óÄ</button>
        <button class="nav-btn" onclick="navigate(1)" title="Next">‚ñ∂</button>
    </div>
    <div class="slide-number" id="slideNumber">1 / 15</div>

    <script>
        let currentSlide = 0;
        const totalSlides = 15;

        function navigate(direction) {
            currentSlide += direction;
            if (currentSlide < 0) currentSlide = 0;
            if (currentSlide >= totalSlides) currentSlide = totalSlides - 1;
            
            const targetSlide = document.getElementById(`slide${currentSlide + 1}`);
            if (targetSlide) {
                targetSlide.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
            
            updateSlideNumber();
        }

        function updateSlideNumber() {
            document.getElementById('slideNumber').textContent = `${currentSlide + 1} / ${totalSlides}`;
        }

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                navigate(1);
            } else if (e.key === 'ArrowLeft') {
                e.preventDefault();
                navigate(-1);
            }
        });

        // Update slide number on scroll
        const slides = document.getElementById('slides');
        slides.addEventListener('scroll', () => {
            const scrollPosition = slides.scrollTop;
            const slideHeight = window.innerHeight;
            const newSlide = Math.round(scrollPosition / slideHeight);
            if (newSlide !== currentSlide) {
                currentSlide = newSlide;
                updateSlideNumber();
            }
        });
    </script>
</body>
</html>
